<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html>
<html lang="en">

<head>
<title>Tetris is Turing-complete</title>
<link rel="stylesheet" href="style.css?v=2022-04-21" type="text/css"/>
<link rel="icon" href="favicon.svg" type="image/svg+xml"/>
<link rel="icon" href="favicon.ico" sizes="any" type="image/x-icon"/>
<link rel="shortcut icon" href="favicon.ico" sizes="any" type="image/x-icon"/>
<link rel="mask-icon" href="mask-icon.svg" color="#000000"/>
<link rel="apple-touch-icon" href="apple-touch-icon.png"/>
<link rel="manifest" href="manifest.json"/>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
<link href="https://fonts.googleapis.com/css2?family=Bentham&family=Open+Sans&family=Source+Code+Pro&family=Source+Serif+Pro&display=swap" rel="stylesheet"/>
<meta name="theme-color" content="#FFFFFF"/>
<meta name="date" content="2022-04-21"/>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
</head>

<body>

<p class="title">Tetris is Turing-complete</p>  
<p>This article presents a method for embedding a programmable, general-purpose, digital computer into Tetris. The capabilities and performance of an implementation are demonstrated by running Tetris on Tetris.</p>

<h1 id="preliminaries">Preliminaries</h1>

<p>The <span class="term">playfield</span> is the grid of square cells where Tetris is played. The standard playfield has 20 visible rows and 10 columns, but the dimensions are arbitrary.</p>

<object data="standard-playfield.svg" type="image/svg+xml" class="diagram">Standard Playfield</object>

<p>Each playfield cell is in one of two states: empty or solid.</p>

<p><span class="term">Tetriminos</span>&mdash;the falling pieces&mdash;consist four solid cells painted any color. The seven Tetriminos have single-character, shape-based names.</p>

<object data="seven-tetriminos.svg" type="image/svg+xml" class="diagram">Seven Tetriminos</object>

<p>A <span class="term">rotation</span> system describes how Tetriminos rotate in relation to the surrounding cells and the playfield boundaries. The method employees the right-handed <a href="https://tetris.wiki/Nintendo_Rotation_System" target="_blank">Nintendo Rotation System</a> (NRS) due to its simplicity, but <a href="https://tetris.wiki/Category:Rotation_systems" target="_blank">various rotation systems</a> exist and any of them could be adapted.</p>

<p>NRS centers each Tetrimino in a 5&times;5 matrix and rotates them 90&deg; about that center. Of the 24 possible orientations, it uses only 19.</p>

<object data="orientation-table.svg" type="image/svg+xml" class="diagram">Orientation Table</object>

<p>The left-most column comprises the spawn orientations (the way the pieces initially appear). The steps of clockwise rotation span left-to-right.</p>

<p>The mnemonics above each orientation consist of the piece type concatenated with the first letter of &ldquo;down&rdquo;, &ldquo;left&rdquo;, &ldquo;up&rdquo;, &ldquo;right&rdquo;, &ldquo;horizontal&rdquo;, &ldquo;vertical&rdquo;, or nothing for O.</p>

<p>A <span class="term">move</span> is a 90&deg; rotation or a 1-cell translation of the piece in play. The following terms apply to translation.</p>

<ul>
    <li>A <span class="term">shift</span> is a horizontal translation.</li>
    <li>A <span class="term">drop</span> is a downward translation.
        <ul>
            <li>A <span class="term">soft drop</span> is a player-controlled, 1-cell drop.</li>
            <li>A <span class="term">hard drop</span> is a meta-move that forces the piece as far down as it can go and <span class="term">locks</span> it into place. It is operationally-equivalent to repeated soft drops.</li>
            <li>A <span class="term">gravity drop</span> is an automatic, 1-cell drop triggered by the <span class="term">fall timer</span>.</li>
        </ul>
    </li>
</ul>

<p>A move is preceded by a <span class="term">request to move</span>. Per NRS, the request is granted iff all four cells of the transformed Tetrimino are empty and are within the bounds of the playfield. If the fall timer’s request for a gravity drop is denied, the piece locks and the next piece spawns.</p>

<p>Spawning involves a <span class="term">randomizer</span>, the mechanism that determines the sequence of pieces presented to the player. Any randomizer guaranteed to eventually produce all seven Tetriminos from any point in the sequence will work with the method.</p>

<h1 id="method-overview">Method Overview</h1>

<p>On an infinite playfield&mdash;bounded only by the floor&mdash;an input data set is encoded into the cells of the bottom-2 rows. Tetriminos are dropped onto those cells, forming a structure logically-equivalent to a Boolean circuit. From the top-2 rows of that structure, an output data set is decoded.</p>

<object data="boolean-circuit.svg" type="image/svg+xml" class="diagram">Boolean Circuit</object>

<p>The output rows serve as input rows of a structure built above it and the process can be repeated indefinitely. The effect is a state machine where the data rows are states and the structures are transition functions.</p>

<object data="state-machine.svg" type="image/svg+xml" class="diagram">State Machine</object>

<p>A construction exists where the data capacity of a state always exceeds its predecessor. It is a means of building an abstract computing device with unbounded storage, a.k.a. a Turing machine.</p>

<h1 id="blindfolded-player">The Blindfolded Player</h1>

<p>Tetris requires a player. But if the player can see the playfield, then constructing a Turing machine is trivial. A sighted player can read input data, perform calculations via any mechanism, and drop pieces to write output data. In other words, it can make Tetris function like RAM.</p>

<p>To inhibit the player from contributing to calculations, it must play blindfolded. Input data, intermediate states, and output data must be inaccessible to the player. With that constraint, if the system composed of the player and the game processes information in the manor of a computer, then Tetris must be functioning as both RAM and a CPU.</p>

<h1 id="infinite-playfield">Infinite Playfield</h1>

<p>On an infinite playfield, completing a line requires infinite pieces and infinite time, neither of which the player can provide. Instead, the player deliberately grows the pile, building unbounded yet finite structures. And because lines are never cleared, the game always remains on the starting level (at the slowest drop speed).</p>

<p>Tetriminos spawn in column 0 at infinite height. Due to the nature of infinity, as a spawned piece falls, it never gets any closer to the floor regardless of the drop speed. In finite (though potentially vast) time, the player can shift the piece into any column. And once in position, it can hard drop to lock the piece into the surface of the pile.</p>

<p>The player can also perform a <span class="term">semihard drop</span>. It works like a hard drop, but instead of stopping when the piece can fall no further, it stops at a specified height. It is the only way to translate a piece from infinity to a finite distance above the floor.</p>

<h1 id="spawn-signal">Spawn Signal</h1>

<p>Since the player cannot see, the game signals when a spawn occurs. It reveals the randomly selected piece to the player, who responds with a timed sequence of requests to move it. If the playfield were empty, the game would satisfy every request and the player would know exactly where the piece is at any time. But the playfield is not empty. Existing pieces can interrupt a shift, as illustrated in the animation below; it shows where the blindfolded player expects a piece to be (left) and where it actually ends up (right).</p>

<object data="shift-interruption.svg" type="image/svg+xml" class="diagram">Shift Interruption</object>

<p>The same applies to gravity and soft drops:</p>

<object data="drop-interruption.svg" type="image/svg+xml" class="diagram">Drop Interruption</object>

<p>Since the spawn signal occurs after a piece locks, it could be abused to extract data out of the playfield, violating the concept of the blindfolded player. This is achieved by semihard dropping a piece into a column and observing how long it takes to lock, which is proportional to the height of the column. The entire surface of the pile could be probed.</p>

<p>To render such abuse ineffective, the method employees a version of Tetris that will not lock a piece until the player hard drops. The piece in play may rest indefinitely on a solid surface pending that explicit request to commit it to the pile.</p>

<h1 id="type-filtering">Type Filtering</h1>

<p>Building a structure logically-equivalent to a Boolean circuit requires placement of a specific sequence of Tetriminos. But the player cannot summon the pieces it needs into existence. Instead, it filters the provided pieces. When the randomizer spawns a piece that the player does not want, the player hard drops it onto an unbounded pile of discards in column &minus;2.</p>

<object data="discards-pile.svg" type="image/svg+xml" class="diagram">Discards Pile</object>

<p>Structures are made from the remaining pieces in columns &ge; 0. That infinite region&mdash;bounded on the bottom by the floor and on the left by the discards pile&mdash;serves as the workspace for building circuits.</p>

<h1 id="boolean-circuit-nodes">Boolean Circuit Nodes</h1>

<p>Nodes consist of pairs of vertically-adjacent cells. They can be in the following states.</p>

<object data="boolean-circuit-nodes.svg" type="image/svg+xml" class="diagram">Boolean Circuit Nodes</object>

<ul>
    <li><span class="mono">0</span> (false) &mdash; lower cell is solid, upper cell is empty.</li> 
    <li><span class="mono">1</span> (true) &mdash; upper cell is solid, lower cell is empty or solid.</li>  
    <li><span class="mono">?</span> (unassigned) &mdash; both cells are empty.</li>  
</ul>

<p>Nodes are composed of one or more pairs, all in the same state. Typically, a node is a contiguous, horizontal line of pairs, but not necessarily. The pairs of a node can be separated in space, even vertically separated. The image below shows one possible encoding of <span class="mono">01010</span>.</p>

<object data="encoding-01010.svg" type="image/svg+xml" class="diagram">01010</object>

<p>The right-most bit is stored in a noncontiguous node.</p>

<h1 id="tetrisscript">TetrisScript</h1>

<p>The player builds structures by executing <span class="term">TetrisScript</span>, a language that specifies where to put the pieces. It only has 3 instructions. The first consists of a mnemonic and a column index:</p>

<p class="definition">mnemonic x</p>

<p>It means:</p>

<ol>
    <li>Discard Tetriminos until the randomizer spawns the one specified by the mnemonic type.</li> 
    <li>Rotate the piece into the mnemonic orientation.</li>   
    <li>Shift the piece to column <span class="mono">x</span>.</li>   
    <li>Hard drop the piece to lock it into the pile.</li> 
</ol>

<p>The code below demonstrates this instruction type.</p>

<pre class="tetrisscript">
<span class="filename">example1.t</span>
<span class="line"><span class="normal">td </span><span class="number">1</span></span>
<span class="line"><span class="normal">jd </span><span class="number">5</span></span>
<span class="line"><span class="normal">zh </span><span class="number">9</span></span>
<span class="line"><span class="normal">o </span><span class="number">13</span></span>
<span class="line"><span class="normal">sh </span><span class="number">16</span></span>
<span class="line"><span class="normal">ld </span><span class="number">20</span></span>
<span class="line"><span class="normal">ih </span><span class="number">25</span></span>
</pre>

<p>If the player carries out those instructions, the following structure results.</p>

<object data="example1.svg" type="image/svg+xml" class="diagram">example1</object>

<p>The second instruction type consists of a mnemonic, a column index, a row index, and a second column index:</p>

<p class="definition">mnemonic x1 y x2</p>

<p>It means:</p>

<ol>
    <li>Discard Tetriminos until the randomizer spawns the one specified by the mnemonic type.</li> 
    <li>Rotate the piece into the mnemonic orientation.</li>   
    <li>Shift the piece to column <span class="mono">x1</span>.</li>
    <li>Semihard drop the piece to row <span class="mono">y</span>.</li>
    <li>Shift the piece to column <span class="mono">x2</span>.</li>
    <li>Hard drop the piece to lock it into the pile.</li> 
</ol>

<p>If a gravity drop were to happen after step 4, but before step 5 finishes, it would corrupt the structure. To prevent that possibility, the player maintains a timer synchronized with the fall timer. The player uses it to semihard drop immediately after a gravity drop, maximizing the time to perform the shift to column <span class="mono">x2</span>. The horizontal distance between <span class="mono">x1</span> and <span class="mono">x2</span> is always tiny, guaranteeing the shift can occur in the period between gravity drops.</p>

<p>The following code demonstrates the second instruction type.</p>

<pre class="tetrisscript">
<span class="filename">example2.t</span>
<span class="line"><span class="normal">td </span><span class="number">1 15 2</span></span>
<span class="line"><span class="normal">jd </span><span class="number">1 15 2</span></span>
<span class="line"><span class="normal">zh </span><span class="number">1 15 2</span></span>
<span class="line"><span class="normal">o </span><span class="number">1 15 2</span></span>
<span class="line"><span class="normal">sh </span><span class="number">1 15 2</span></span>
<span class="line"><span class="normal">ld </span><span class="number">1 15 2</span></span>
<span class="line"><span class="normal">ih </span><span class="number">1 15 2</span></span>
</pre>

<p>Those are the instructions for the structure below.</p>

<object data="example2.svg" type="image/svg+xml" class="diagram">example2</object>

<p>The third instruction type provides a way to compose complex structures from simpler ones. It consists of a structure name and a pair of coordinates:</p>

<p class="definition">structure x y</p>

<p>It means: build the specified structure at location <span class="mono">(x,y)</span>.</p>

<p>The following code demonstrates this instruction type by referencing the prior examples.</p>

<pre class="tetrisscript">
<span class="filename">example3.t</span>
<span class="line"><span class="normal">example1 </span><span class="number">3 0</span></span>
<span class="line"><span class="normal">example2 </span><span class="number">14 2</span></span>
</pre>

<p>Column and row indices within the structures are offset by the provided coordinates, which makes the code above equivalent to:</p>

<pre class="tetrisscript">
<span class="filename">example3Expanded.t</span>
<span class="line"><span class="comment"># example1 3 0</span></span>
<span class="line"><span class="normal">td </span><span class="number">4</span></span>
<span class="line"><span class="normal">jd </span><span class="number">8</span></span>
<span class="line"><span class="normal">zh </span><span class="number">12</span></span>
<span class="line"><span class="normal">o </span><span class="number">16</span></span>
<span class="line"><span class="normal">sh </span><span class="number">19</span></span>
<span class="line"><span class="normal">ld </span><span class="number">23</span></span>
<span class="line"><span class="normal">ih </span><span class="number">28</span></span>
<span class="line"></span>
<span class="line"><span class="comment"># example2 14 2</span></span>
<span class="line"><span class="normal">td </span><span class="number">15 17 16</span></span>
<span class="line"><span class="normal">jd </span><span class="number">15 17 16</span></span>
<span class="line"><span class="normal">zh </span><span class="number">15 17 16</span></span>
<span class="line"><span class="normal">o </span><span class="number">15 17 16</span></span>
<span class="line"><span class="normal">sh </span><span class="number">15 17 16</span></span>
<span class="line"><span class="normal">ld </span><span class="number">15 17 16</span></span>
<span class="line"><span class="normal">ih </span><span class="number">15 17 16</span></span>
</pre>

<p>Lines 1 and 10 are comments.</p>

<p>Circular references are not allowed. The code must be fully expandable to mnemonic instructions.</p>

<p>Executing that code produces:</p>

<object data="example3.svg" type="image/svg+xml" class="diagram">example3</object>

<p>To make testing circuits easier, TetrisScript provides syntax for labeling nodes:</p>

<p class="definition">in/out name x y ...</p>

<p>The node type&mdash;<span class="mono">in</span> or <span class="mono">out</span>&mdash;is followed by the node name. The successive coordinates specify the node location. They refer to the lower-cell of the vertically-adjacent pairs. Spans can be indicated with range notation (<span class="mono">begin..end</span>). Multiple coordinate pairs/ranges can be provided for disjoint nodes.</p>

<p>The example below declares 5 input nodes.</p>

<pre class="tetrisscript">
<span class="filename">nodes.t</span>
<span class="line"><span class="keyword">in </span><span class="normal">a </span><span class="number">0 0</span></span>
<span class="line"><span class="keyword">in </span><span class="normal">b </span><span class="number">2..4 0</span></span>
<span class="line"><span class="keyword">in </span><span class="normal">c </span><span class="number">6 0</span></span>
<span class="line"><span class="keyword">in </span><span class="normal">d </span><span class="number">7 0</span></span>
<span class="line"><span class="keyword">in </span><span class="normal">e </span><span class="number">9..10 0 12..13 0</span></span>
</pre>

<p>Node <span class="mono">a</span> is a single pair. Node <span class="mono">b</span> is a horizontal line consisting of 3 pairs. Nodes <span class="mono">c</span> and <span class="mono">d</span> are adjoining, single pairs. Node <span class="mono">e</span> is disjoint. They are illustrated below, where nodes <span class="mono">a</span>, <span class="mono">b</span>, <span class="mono">c</span>, <span class="mono">d</span>, and <span class="mono">e</span> are set to <span class="mono">0</span>, <span class="mono">1</span>, <span class="mono">0</span>, <span class="mono">1</span>, and <span class="mono">0</span>, respectively.</p>

<object data="nodes.svg" type="image/svg+xml" class="diagram">Nodes</object>

<h1 id="logic-gates">Logic Gates</h1>

<p>This section explains how to construct logic gates, structures that produce a single binary output from one or more binary inputs.</p>

<h2 id="buffer">Buffer</h2>

<p>A buffer is a single-input, binary <a href="https://en.wikipedia.org/wiki/Identity_function" target="_blank">identity function</a>. The output value is the input value, unchanged.</p>

<p>The code below realizes a buffer by dropping a vertically-oriented I-Tetrimino onto an input node.</p>

<pre class="tetrisscript">
<span class="filename">buffer.t</span>
<span class="line"><span class="normal">iv </span><span class="number">0</span></span>
<span class="line"></span>
<span class="line"><span class="keyword">in </span><span class="normal">i </span><span class="number">0 0</span></span>
<span class="line"><span class="keyword">out </span><span class="normal">o </span><span class="number">0 4</span></span>
</pre>

<p>The result for both input values is shown below.</p>

<object data="animated-buffer.svg" type="image/svg+xml" class="diagram">Animated Buffer</object>

<p>The cells of the output node mirror the cells of the input node. Any Tetrimino or any stack of Tetriminos can be used to copy data in this way.</p>

<h2 id="inverter-not">Inverter (NOT)</h2>

<p>An inverter is a single-input gate where the output is the <a href="https://en.wikipedia.org/wiki/Negation" target="_blank">complement</a> of the input.</p>

<p>The code below makes an inverter by sandwiching an O-Tetrimino between horizontal L-and-J-Tetriminos.</p>

<pre class="tetrisscript">
<span class="filename">not.t</span>
<span class="line"><span class="normal">lu </span><span class="number">0</span></span>
<span class="line"><span class="normal">o </span><span class="number">0 4 1</span></span>
<span class="line"><span class="normal">jd </span><span class="number">0</span></span>
<span class="line"></span>
<span class="line"><span class="keyword">in </span><span class="normal">i </span><span class="number">-1..1 0</span></span>
<span class="line"><span class="keyword">out </span><span class="normal">o </span><span class="number">-1..1 5</span></span>
</pre>

<p>Note: Although workspace coordinates are always &ge; 0 due to the floor and the discards pile, structure definitions can use negative column values because the coordinates are relative to where the structure is built.</p>

<p>The follow animation shows what happens for both input values.</p>

<object data="animated-not.svg" type="image/svg+xml" class="diagram">Animated NOT</object>

<p>When the input is <span class="mono">0</span>, the L-Tetrimino lands low, which enables the O-Tetrimino to shift upon its protuberance. In turn, the J-Tetrimino lands high.</p>

<p>When the input is <span class="mono">1</span>, the L-Tetrimino lands high and acts a barrier that obstructs the horizontal movement of the O-Tetrimino. The result is a configuration where the J-Tetrimino lands low.</p>

<p>In both cases, the output is the opposite of the input.</p>

<p>A horizontally reflected version exists purely for aesthetics reasons. The image below shows <span class="mono">notLeft</span> (an alias for <span class="mono">not</span>) and its reflection, <span class="mono">notRight</span>.</p>

<object data="nots.svg" type="image/svg+xml" class="diagram">notLeft and notRight</object>

<h2 id="or">OR</h2>

<p>OR is a 2-input gate that performs <a href="https://en.wikipedia.org/wiki/Logical_disjunction" target="_blank">disjunction</a>. The output is <span class="mono">0</span> only when both inputs are <span class="mono">0</span>.</p>

<p>The code below creates an OR gate by dropping a single O-Tetrimino onto abutting input nodes.</p>

<pre class="tetrisscript">
<span class="filename">or.t</span>
<span class="line"><span class="normal">o </span><span class="number">0</span></span>
<span class="line"></span>
<span class="line"><span class="keyword">in </span><span class="normal">a </span><span class="number">-1 0</span></span>
<span class="line"><span class="keyword">in </span><span class="normal">b </span><span class="number">0 0</span></span>
<span class="line"><span class="keyword">out </span><span class="normal">o </span><span class="number">-1..0 2</span></span>
</pre>

<p>Here are the results for all input combinations:</p>

<object data="or.svg" type="image/svg+xml" class="diagram">OR</object>

<p>The O-Tetrimino lands low unless one or both inputs is <span class="mono">1</span>.</p>

<h2 id="nor">NOR</h2>

<p>NOR is a 2-input gate that evaluates the <a href="https://en.wikipedia.org/wiki/Logical_NOR" target="_blank">joint denial</a>. The output is <span class="mono">1</span> only when both inputs are <span class="mono">0</span>. It is a <a href="https://en.wikipedia.org/wiki/Logic_gate#Universal_logic_gates" target="_blank">universal gate</a> that can be combined to form any other logic gate.</p>

<p>The code below realizes a NOR gate by feeding 2 inputs into an inverter.</p>

<pre class="tetrisscript">
<span class="filename">nor.t</span>
<span class="line"><span class="normal">not </span><span class="number">0 0</span></span>
<span class="line"></span>
<span class="line"><span class="keyword">in </span><span class="normal">a </span><span class="number">-1..0 0</span></span>
<span class="line"><span class="keyword">in </span><span class="normal">b </span><span class="number">1 0</span></span>
<span class="line"><span class="keyword">out </span><span class="normal">o </span><span class="number">-1..1 5</span></span>
</pre>

<p>The following image presents the outputs for all possible inputs.</p>

<object data="nor.svg" type="image/svg+xml" class="diagram">NOR</object>

<p>The L-Tetrimino operates as an OR gate, resulting in output opposite of OR.</p>

<h2 id="nand">NAND</h2>

<p>NAND is a 2-input gate that provides the complement of <a href="https://en.wikipedia.org/wiki/Logical_conjunction" target="_blank">conjunction</a>. The output is <span class="mono">0</span> only when both inputs are <span class="mono">1</span>. It is a universal gate that can be combined to form any other logic gate.</p>

<p>From <a href="https://en.wikipedia.org/wiki/De_Morgan%27s_laws" target="_blank">De Morgan's laws</a>: <span class="math"><span class="overline">AB</span> &equiv; <span class="overline">A</span> + <span class="overline">B</span></span>. The code below uses this equivalence. It realizes NAND as inverters feeding into an OR.</p>

<pre class="tetrisscript">
<span class="filename">nand.t</span>
<span class="line"><span class="normal">notLeft </span><span class="number">-2 0</span></span>
<span class="line"><span class="normal">notRight </span><span class="number">1 0</span></span>
<span class="line"><span class="normal">ih </span><span class="number">0</span></span>
<span class="line"></span>
<span class="line"><span class="keyword">in </span><span class="normal">a </span><span class="number">-3..-1 0</span></span>
<span class="line"><span class="keyword">in </span><span class="normal">b </span><span class="number">0..2 0</span></span>
<span class="line"><span class="keyword">out </span><span class="normal">o </span><span class="number">-2..1 6</span></span>
</pre>

<p>The follow image reveals the output for all possible inputs.</p>

<object data="nand.svg" type="image/svg+xml" class="diagram">NAND</object>

<p>The horizontal I-Tetrimino functions as an OR gate.</p>

<h2 id="and">AND</h2>

<p>AND is a 2-input gate that performs <a href="https://en.wikipedia.org/wiki/Logical_conjunction" target="_blank">conjunction</a>. The output is <span class="mono">1</span> only when both inputs are <span class="mono">1</span>.</p>

<p>The code below constructs AND from a NAND gate followed by an inverter.</p>

<pre class="tetrisscript">
<span class="filename">and.t</span>
<span class="line"><span class="normal">notLeft </span><span class="number">-2 0</span></span>
<span class="line"><span class="normal">notRight </span><span class="number">1 0</span></span>
<span class="line"><span class="normal">notRight </span><span class="number">0 5</span></span>
<span class="line"></span>
<span class="line"><span class="keyword">in </span><span class="normal">a </span><span class="number">-3..-1 0</span></span>
<span class="line"><span class="keyword">in </span><span class="normal">b </span><span class="number">0..2 0</span></span>
<span class="line"><span class="keyword">out </span><span class="normal">o </span><span class="number">-1..1 10</span></span>
</pre>

<p>The following image shows the outputs for all possible inputs.</p>

<object data="and.svg" type="image/svg+xml" class="diagram">AND</object>

<p>The J-Tetrimino of the upper inverter functions as an OR gate.</p>

<h2 id="xor">XOR</h2>

<p>XOR is a 2-input gate that performs <a href="https://en.wikipedia.org/wiki/Exclusive_or" target="_blank">exclusive disjunction</a>. It outputs <span class="mono">1</span> only when both inputs are unequal.</p>

<p>From <a href="https://en.wikipedia.org/wiki/De_Morgan%27s_laws" target="_blank">De Morgan's laws</a>:</p>

<p><span class="math">A &#8853; B<span></p>
      
<p><span class="math">&equiv; A &ne; B</p>      
      
<p><span class="math">&equiv; <span class="overline">A</span>B + A<span class="overline">B</span></p>      
     
<p><span class="math">&equiv; <span class="overline">A</span>A + <span class="overline">A</span>B + A<span class="overline">B</span> + B<span class="overline">B</span><span></p>
      
<p><span class="math">&equiv; <span class="overline">A</span>(A + B) + <span class="overline">B</span>(A + B)</p>  

<p><span class="math">&equiv; <span class="overline">A</span> <span class="overline">C</span> + <span class="overline">B</span> <span class="overline">C</span>, C &equiv; <span class="overline">A + B</span></p>  

<p><span class="math">&equiv; <span class="overline">A + C</span> + <span class="overline">B + C</span>, C &equiv; <span class="overline">A + B</span></span></p>

<p>That suggests the following construction of XOR from 3 NOR gates and an OR gate.</p>

<object data="xor-schematic.svg" type="image/svg+xml" class="diagram">XOR Schematic</object>

<p>The code below is based on that schematic.</p>

<pre class="tetrisscript">
<span class="filename">xor.t</span>
<span class="line"><span class="normal">ih </span><span class="number">-2</span></span>
<span class="line"><span class="normal">ih </span><span class="number">2</span></span>
<span class="line"><span class="normal">iv </span><span class="number">-4</span></span>
<span class="line"><span class="normal">iv </span><span class="number">3</span></span>
<span class="line"><span class="normal">_norLeft </span><span class="number">0 1</span></span>
<span class="line"><span class="normal">lu </span><span class="number">-2</span></span>
<span class="line"><span class="normal">ju </span><span class="number">1</span></span>
<span class="line"><span class="normal">notLeft </span><span class="number">2 5</span></span>
<span class="line"><span class="normal">notRight </span><span class="number">-3 5</span></span>
<span class="line"><span class="normal">ih </span><span class="number">0</span></span>
<span class="line"></span>
<span class="line"><span class="keyword">in </span><span class="normal">a </span><span class="number">-4..-1 0</span></span>
<span class="line"><span class="keyword">in </span><span class="normal">b </span><span class="number">0..3 0</span></span>
<span class="line"><span class="keyword">out </span><span class="normal">o </span><span class="number">-2..1 11</span></span>
</pre>

<p><span class="mono">_norLeft</span> is a NOR gate composed of two O-Tetriminos. It is detailed in a later section.</p>

<p>Here are the results for all input combinations:</p>

<object data="xor.svg" type="image/svg+xml" class="diagram">XOR</object>

<p>The vertical I-Tetriminos and the L-and-J-Tetriminos resting on the O-Tetrimino act as wires. The bases of the inverters serve as OR gates, making them function as NORs. The horizontal I-Tetrimino at the top operates as an OR gate.</p>

<h2 id="xnor">XNOR</h2>

<p>XNOR is a 2-input gate that evaluates <a href="https://en.wikipedia.org/wiki/Logical_equality" target="_blank">equality</a>. The output is <span class="mono">1</span> only when both inputs are equal. It is the complement of XOR.</p>

<p>The code below composes XNOR from XOR followed by an inverter.</p>

<pre class="tetrisscript">
<span class="filename">xnor.t</span>
<span class="line"><span class="normal">xor </span><span class="number">0 0</span></span>
<span class="line"><span class="normal">notLeft </span><span class="number">0 11</span></span>
<span class="line"></span>
<span class="line"><span class="keyword">in </span><span class="normal">a </span><span class="number">-4..-1 0</span></span>
<span class="line"><span class="keyword">in </span><span class="normal">b </span><span class="number">0..3 0</span></span>
<span class="line"><span class="keyword">out </span><span class="normal">o </span><span class="number">-1..1 16</span></span>
</pre>

<p>The following image shows the outputs for all possible inputs.</p>

<object data="xnor.svg" type="image/svg+xml" class="diagram">XNOR</object>

<h1 id="wires">Wires</h1>

<p>This section discusses <span class="term">wires</span>, the structures that transfer bits from one part of a circuit to another.</p>

<h2 id="fan-out">Fan-out</h2>

<p><span class="term">Fan-out</span> is the number of connections radiating from an output node. As illustrated in the animation below, lines of S-and-Z-Tetriminos enable unlimited fan-out.</p>

<object data="fan-out.svg" type="image/svg+xml" class="diagram">Fan-out</object>

<p>Rising staircases of horizontal I-Tetriminos can achieve the same.</p>

<h2 id="fan-in">Fan-in</h2>

<p>Wires that converge on a common node require a device to combine their signals, such as a multi-input OR gate. <span class="term">Fan-in</span> is the number of inputs of such a device. As demonstrated in the following animation, a line of Z-or-S-Tetriminos can provide unlimited fan-in. </p>

<object data="fan-in.svg" type="image/svg+xml" class="diagram">Fan-in</object>

<p>Alternatively, a tree of gates can merge a boundless number of inputs.</p>

<h2 id="crossing">Crossing</h2>

<p>The wires of a circuit can cross over each other without connecting in a 3-dimensional universe. But, on the 2-dimensional playfield, a cross requires a planar device that mutually exchanges 2 inputs. The device implements the <a href="https://en.wikipedia.org/wiki/XOR_swap_algorithm" target="_blank">XOR swap algorithm</a>. It stores the XOR of inputs <span class="math">A</span> and <span class="math">B</span> into a temporary variable, <span class="math">C</span>: </p>

<p><span class="math">C &equiv; A &#8853; B</span></p>

<p>Then it XORs the inputs with the temporary variable, which swaps them:</p>

<p><span class="math">A &#8853; C &equiv; A &#8853; A &#8853; B &equiv; B</span></p>

<p><span class="math">B &#8853; C &equiv; B &#8853; A &#8853; B &equiv; A</span></p>

<p>The algorithm suggests the following circuit.</p>

<object data="swap-schematic.svg" type="image/svg+xml" class="diagram">Swap Schematic</object>

<p>Since the circuit has no cross-overs and XOR is realizable, it achieves a planar swap.</p>

<p>In the code below, which is based on that schematic, the lower XOR gate is expanded into 3 NORs and a horizontal I-Tetrimino operating as an OR. The other pieces function as wires.</p>

<pre class="tetrisscript">
<span class="filename">swap.t</span>
<span class="line"><span class="normal">ih </span><span class="number">-2</span></span>
<span class="line"><span class="normal">ih </span><span class="number">2</span></span>
<span class="line"><span class="normal">ll </span><span class="number">-4</span></span>
<span class="line"><span class="normal">jr </span><span class="number">3</span></span>
<span class="line"><span class="normal">ih </span><span class="number">-5</span></span>
<span class="line"><span class="normal">ih </span><span class="number">5</span></span>
<span class="line"><span class="normal">_norLeft </span><span class="number">0 1</span></span>
<span class="line"><span class="normal">lu </span><span class="number">-2</span></span>
<span class="line"><span class="normal">ju </span><span class="number">1</span></span>
<span class="line"><span class="normal">_norLeft </span><span class="number">-3 5</span></span>
<span class="line"><span class="normal">_norRight </span><span class="number">3 5</span></span>
<span class="line"><span class="normal">ih </span><span class="number">-2</span></span>
<span class="line"><span class="normal">ih </span><span class="number">2</span></span>
<span class="line"><span class="normal">iv </span><span class="number">-7</span></span>
<span class="line"><span class="normal">iv </span><span class="number">6 7</span></span>
<span class="line"><span class="normal">ih </span><span class="number">0</span></span>
<span class="line"><span class="normal">jd </span><span class="number">-6</span></span>
<span class="line"><span class="normal">ld </span><span class="number">5</span></span>
<span class="line"><span class="normal">xor </span><span class="number">-4 10</span></span>
<span class="line"><span class="normal">xor </span><span class="number">4 10</span></span>
<span class="line"></span>
<span class="line"><span class="keyword">in </span><span class="normal">i1 </span><span class="number">-4..-1 0</span></span>
<span class="line"><span class="keyword">in </span><span class="normal">i0 </span><span class="number">0..3 0</span></span>
<span class="line"><span class="keyword">out </span><span class="normal">o1 </span><span class="number">-6..-3 21</span></span>
<span class="line"><span class="keyword">out </span><span class="normal">o0 </span><span class="number">2..5 21</span></span>
</pre>

<p><span class="mono">_norLeft</span> and <span class="mono">_norRight</span> are NOR gates composed of two O-Tetriminos. They are detailed in a later section.</p>

<p>Here are the results for all input combinations:</p>

<object data="swap.svg" type="image/svg+xml" class="diagram">Swap</object>

<p>The following animation makes repeated use of the swap circuit. It shows a diagonal wire crossing over multiple vertical wires.</p>

<object data="cross-seven.svg" type="image/svg+xml" class="diagram">Cross Seven</object>

<h2 id="multiplexing">Multiplexing</h2>

<p>A multiplexer is a controlled switch that channels one of the inputs to the output. The output of a 2-to-1 multiplexer is <span class="math">AS + B<span class="overline">S</span></span> where <span class="math">A</span> and <span class="math">B</span> are the inputs, and <span class="math">S</span> is the selector.</p>

<p>From <a href="https://en.wikipedia.org/wiki/De_Morgan%27s_laws" target="_blank">De Morgan's laws</a>:</p>

<p><span class="math">AS + B<span class="overline">S</span></span></p>

<p><span class="math">&equiv; AS + <span class="high-overline"><span class="overline">B</span> + S</span></span></p>

<p><span class="math">&equiv; <span class="high-overline"><span class="overline">AS</span>(<span class="overline">B</span> + S)</span></span></p>

<p>That suggests the following construction from 2 NAND gates, an OR gate, and an inverter.</p>

<object data="mux-schematic.svg" type="image/svg+xml" class="diagram">Multiplexer Schematic</object>

<p>The code below is based on that schematic.</p>

<pre class="tetrisscript">
<span class="filename">muxLeft.t</span>
<span class="line"><span class="normal">ih </span><span class="number">0</span></span>
<span class="line"><span class="normal">ih </span><span class="number">4</span></span>
<span class="line"><span class="normal">ih </span><span class="number">-4</span></span>
<span class="line"><span class="normal">notLeft </span><span class="number">-4 1</span></span>
<span class="line"><span class="normal">notRight </span><span class="number">-1 1</span></span>
<span class="line"><span class="normal">notRight </span><span class="number">4 1</span></span>
<span class="line"><span class="normal">jr </span><span class="number">1</span></span>
<span class="line"><span class="normal">o </span><span class="number">2</span></span>
<span class="line"><span class="normal">ih </span><span class="number">-2</span></span>
<span class="line"><span class="normal">ih </span><span class="number">3</span></span>
<span class="line"><span class="normal">nand </span><span class="number">0 7</span></span>
<span class="line"></span>
<span class="line"><span class="keyword">in </span><span class="normal">l </span><span class="number">-6..-3 0</span></span>
<span class="line"><span class="keyword">in </span><span class="normal">s </span><span class="number">-2..1 0</span></span>
<span class="line"><span class="keyword">in </span><span class="normal">r </span><span class="number">2..5 0</span></span>
<span class="line"><span class="keyword">out </span><span class="normal">o </span><span class="number">-2..1 13</span></span>
</pre>

<p>Here are the results for all input combinations:</p>

<object data="mux.svg" type="image/svg+xml" class="diagram">Multiplexer</object>

<p>The selector (the center input) is <span class="mono">0</span> in the upper row and <span class="mono">1</span> in the lower row. As its name suggests, <span class="mono">muxLeft</span> outputs the left input when the selector is <span class="mono">1</span>. The horizontally reflected version, <span class="mono">muxRight</span>, outputs the right input when the selector is <span class="mono">1</span>.</p>

<h1 id="time-independence">Time Independence</h1>

<p><a href="https://en.wikipedia.org/wiki/Race_condition" target="_blank">Race conditions</a> never occur because the signal arrival order for a component is entirely determined by the Tetrimino sequence. Path lengths and the components along paths have no bearing on that order. Moreover, the order is inconsequential since a component will not be built until all of its input nodes are assigned. And once assigned, nodes values are permanent. They cannot waver transiently into stable states.</p>

<h1 id="functions">Functions</h1>

<p>This section describes the arithmetic and logic functions created for the computer.</p>

<h2 id="interoperability">Interoperability</h2>

<p>The functions are normalized for interoperability. The output of one can serve as the input of another, and they can be stacked indefinitely. To make that work, the input and output nodes line up with each other, and they are evenly spaced, 10 cells apart. The spacing was selected to provide sufficient room for wide components, such as the <a href="#crossing">swap circuit</a>. Plus, a round, base-10 number makes measurements easier.</p>

<h2 id="identity">Identity</h2>

<p>An <a href="https://en.wikipedia.org/wiki/Identity_function" target="_blank">identity function</a> echos the provided value:</p>

<p><span class="math">f(x) &equiv; x</span></p> 

<p>The image below depicts an 8-bit identity function. The height is arbitrary.</p>

<object data="identity.svg" type="image/svg+xml" class="diagram">Identity</object>

<h2 id="constant">Constant</h2>

<p>A constant function returns the same value regardless of the argument:</p>

<p><span class="math">f(x) &equiv; k</span></p>

<p>There are two 1-bit versions. The first outputs <span class="mono">0</span>. This is achieved by XORing the input with itself:</p>

<p><span class="math">f(A) &equiv; A &#8853; A &equiv; </span><span class="serif">0</span></p>

<p>The code below links both inputs of an XOR gate with a horizontal I-Tetrimino.</p>

<pre class="tetrisscript">
<span class="filename">false.t</span>
<span class="line"><span class="normal">ih </span><span class="number">0</span></span>
<span class="line"><span class="normal">xor </span><span class="number">0 1</span></span>
<span class="line"></span>
<span class="line"><span class="keyword">in </span><span class="normal">i </span><span class="number">-2..1 0</span></span>
<span class="line"><span class="keyword">out </span><span class="normal">o </span><span class="number">-2..1 12</span></span>
</pre>

<p>The tests in the following image affirm the circuit always outputs <span class="mono">0</span>.</p>

<object data="false.svg" type="image/svg+xml" class="diagram">False</object>

<p>The second 1-bit function outputs <span class="mono">1</span>. This is accomplished by XNORing the input with itself:</p>

<p><span class="math">f(A) &equiv; <span class="overline">A &#8853; A</span> &equiv; </span><span class="serif">1</span></p>

<p>A horizontal I-Tetrimino joins the inputs of an XNOR gate in the code below.</p>

<pre class="tetrisscript">
<span class="filename">true.t</span>
<span class="line"><span class="normal">ih </span><span class="number">0</span></span>
<span class="line"><span class="normal">xnor </span><span class="number">0 1</span></span>
<span class="line"></span>
<span class="line"><span class="keyword">in </span><span class="normal">i </span><span class="number">-2..1 0</span></span>
<span class="line"><span class="keyword">out </span><span class="normal">o </span><span class="number">-1..1 17</span></span>
</pre>

<p>The following image reveals the circuit invariably yields <span class="mono">1</span>.</p>

<object data="true.svg" type="image/svg+xml" class="diagram">True</object>

<p>8-bit constant functions are realized by applying the 1-bit versions to each bit. The following example resets a byte to <span class="mono">0</span>.</p>

<object data="clear.svg" type="image/svg+xml" class="diagram">Clear</object>

<p>The image below depicts the requisite <span class="math">f(x) &equiv; </span><span class="serif">42</span> function. </p>

<object data="constant-42.svg" type="image/svg+xml" class="diagram">42</object>

<h2 id="logical-left-shift">Logical Left Shift</h2>

<p>Logical left shift is an 8-bit function that moves every input bit one position to the left. The rightmost bit is set to <span class="mono">0</span> and the leftmost bit is lost:</p>

<object data="logical-left-shift.svg" type="image/svg+xml" class="diagram">Logical Left Shift</object>

<p>The circuit can be stacked to shift by an arbitrary number of bit positions. Shifting a signed or unsigned value left by <span class="math">n</span> bits is equivalent to multiplying by <span class="serif">2</span><span class="math pow">n</span>: 

<p><span class="math">f(x) &equiv; </span><span class="serif">2</span><span class="math pow">n</span><span class="math">x</span></p>

<h2 id="logical-right-shift">Logical Right Shift</h2>

<p>Logical right shift is an 8-bit function that moves every input bit one position to the right. The leftmost bit is set to <span class="mono">0</span> and the right most bit is lost:</p>

<object data="logical-right-shift.svg" type="image/svg+xml" class="diagram">Logical Right Shift</object>

<p>The circuit can be stacked to shift by an arbitrary number of bit positions. Shifting an unsigned value right by <span class="math">n</span> bits is equivalent to dividing by <span class="serif">2</span><span class="math pow">n</span> (rounding toward <span class="serif">0</span>):</p>

<p><span class="math">f(x) &equiv; </span><span class="math">x</span><span class="serif">/2</span><span class="math pow">n</span></p>

<h2 id="decrementer">Decrementer</h2>

<p>A <a href="https://en.wikipedia.org/wiki/Subtractor#Half_subtractor" target="_blank">half subtractor</a> is a circuit that accepts a 1-bit <a href="https://en.wikipedia.org/wiki/Subtraction#Notation_and_terminology" target="_blank">minuend</a>, <span class="math">X</span>, and a 1-bit <a href="https://en.wikipedia.org/wiki/Subtraction#Notation_and_terminology" target="_blank">subtrahend</a>, <span class="math">Y</span>, and outputs their signed difference. The difference is a 2-bit value composed of the sign bit, <span class="math">B</span>, and the ones bit, <span class="math">D</span>. The table below lists all possibilities.</p>

<table class="borderless">
<tr><th class="math">X</th><th class="math">Y</th><th class="border-left math">B</th><th class="math">D</th><th class="border-left borderless">Meaning</th></tr>
<tr><td class="mono">0</td><td class="mono">0</td><td class="border-left mono">0</td><td class="mono">0</td><td class="border-left borderless"><span class="serif">0 &minus; 0 = 0</span></td></tr>
<tr><td class="mono">0</td><td class="mono">1</td><td class="border-left mono">1</td><td class="mono">1</td><td class="border-left borderless"><span class="serif">0 &minus; 1 = &minus;1</span></td></tr>
<tr><td class="mono">1</td><td class="mono">0</td><td class="border-left mono">0</td><td class="mono">1</td><td class="border-left borderless"><span class="serif">1 &minus; 0 = 1</span></td></tr>
<tr><td class="mono">1</td><td class="mono">1</td><td class="border-left mono">0</td><td class="mono">0</td><td class="border-left borderless"><span class="serif">1 &minus; 1 = 0</span></td></tr>
</table>

<p><span class="math">B</span> and <span class="math">D</span> can be expressed as:</p>

<p><span class="math">B &equiv; <span class="overline">X</span>Y</span></p>

<p><span class="math">D &equiv; X &#8853; Y &equiv; X &ne; Y &equiv; <span class="overline">X</span>Y + X<span class="overline">Y</span> &equiv; B + X<span class="overline">Y</span></span></p>

<p>From <a href="https://en.wikipedia.org/wiki/De_Morgan%27s_laws" target="_blank">De Morgan's laws</a>:</p>

<p><span class="math"><span class="overline">X</span>Y &equiv; <span class="overline">X</span>X + <span class="overline">X</span>Y &equiv; <span class="overline">X</span>(X + Y) &equiv; <span class="high-overline">X + <span class="overline">X + Y</span></span> &equiv; <span class="overline">X + C</span>, C &equiv; <span class="overline">X + Y</span></span></p>

<p><span class="math">X<span class="overline">Y</span> &equiv; X<span class="overline">Y</span> + Y<span class="overline">Y</span> &equiv; <span class="overline">Y</span>(X + Y) &equiv; <span class="high-overline">Y + <span class="overline">X + Y</span></span> &equiv; <span class="overline">Y + C</span>, C &equiv; <span class="overline">X + Y</span></span></p>

<p>Cleaning up:</p>

<p><span class="math">C &equiv; <span class="overline">X + Y</span></span></p>

<p><span class="math">B &equiv; <span class="overline">X + C</span></span></p>

<p><span class="math">D &equiv; B + <span class="overline">Y + C</span></span></p>

<p>That implies the following circuit.</p>

<object data="half-subtractor-schematic.svg" type="image/svg+xml" class="diagram">Half Subtractor Schematic</object>

<p>In the code below, which is based on that schematic, a horizontal I-Tetrimino functions as the upper OR.</p>

<pre class="tetrisscript">
<span class="filename">halfSubtractor.t</span>
<span class="line"><span class="normal">ih </span><span class="number">0</span></span>
<span class="line"><span class="normal">ih </span><span class="number">4</span></span>
<span class="line"><span class="normal">jl </span><span class="number">-1</span></span>
<span class="line"><span class="normal">iv </span><span class="number">-2</span></span>
<span class="line"><span class="normal">lr </span><span class="number">3</span></span>
<span class="line"><span class="normal">iv </span><span class="number">4</span></span>
<span class="line"><span class="normal">nor nor1 </span><span class="number">1 1</span></span>
<span class="line"><span class="normal">nor nor2 </span><span class="number">-1 6</span></span>
<span class="line"><span class="normal">nor nor3 </span><span class="number">3 6</span></span>
<span class="line"><span class="normal">ih </span><span class="number">-3</span></span>
<span class="line"><span class="normal">ih </span><span class="number">1</span></span>
<span class="line"><span class="normal">ju </span><span class="number">-1</span></span>
<span class="line"><span class="normal">ju </span><span class="number">-4</span></span>
<span class="line"></span>
<span class="line"><span class="keyword">in </span><span class="normal">x </span><span class="number">-2..1 0</span></span>
<span class="line"><span class="keyword">in </span><span class="normal">y </span><span class="number">2..5 0</span></span>
<span class="line"><span class="keyword">out </span><span class="normal">b </span><span class="number">-5 14</span></span>
<span class="line"><span class="keyword">out </span><span class="normal">d </span><span class="number">-2 14</span></span>
</pre>

<p>Here are the outputs for all possible inputs:</p>

<object data="half-subtractor.svg" type="image/svg+xml" class="diagram">Half Subtractor</object>

</body>

</html>
